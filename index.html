<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Blog Marchena</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        body{
            background-image: url('https://wallpaperaccess.com/full/5457303.png');
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100vh;
            margin: 0;
            font-family: sans-serif;
        }

        #root{
          display: flex;
          justify-content: center;
        }

        .centerPage{
            background-color: #ACA6E5;
            height: fit-content;
            width: 50vw;
            padding: 2vh;
            display: flex;
            flex-direction: column;
            gap: 4vh;
        }

        .pressed { background-color: lightgrey; }

        .post{
          background-color: #E5BAD1;
          border-radius: 2vh;
          width: 46vw;
          height: fit-content;
          padding: 2vh;
          border-bottom: solid 0.5vh #c9a1a1;
          border-left: solid 0.5vh #c9a1a1;
        }

        .postContent{
          display: flex;
          align-items: center;
          gap: 2vh
        }

        .postText{
          display: flex;
          flex-direction: column;
          gap: 3vh
        }
        img{
          max-height: 40vh;
          max-width: 13vw;
        }
        .imgHolder{
          display: flex;
          flex-direction: column;
          align-items: center;
          padding: 2vh;
          background-color: #EFEF90;
          width: fit-content;
          border-radius: 2vh;
          border-bottom: solid 0.5vh #d6b77d;
          border-left: solid 0.5vh #d6b77d;
        }
        header{
          background-color: #9DD1E5;
          padding: 3vh;
          font-size: 3.5vh;
          width: 49.2vw;
          display: flex;
          align-items: center;
          justify-content: center;
        }

        .loading {
          width: 10vh; /* Adjust width as needed */
          height: auto; /* Maintain aspect ratio */
          transform: rotate(0deg);
      }

    </style>
</head>
<body>
    <header>Mi blog de peliculas</header>
    <div id="root"></div>
    <script type="text/babel"> 


      const Loading = () => {
        const [rotation, setRotation] = React.useState(0);
      
        React.useEffect(() => {
          const intervalId = setInterval(() => {
            setRotation(rotation => rotation + 2);
          }, 10);
      
          return () => clearInterval(intervalId);
        }, []); 

        const style = {
          transform: `rotate(${rotation}deg)`
        };
      
        return (
          <center>
            <img src="https://cdn-icons-png.flaticon.com/512/189/189792.png" alt="Cargando Contenido" className="loading" style={style}/>
          </center>
            
        );
      };


    const ImageRender = ({url, movieTitle}) => {
       return(
        <div className="imgHolder">
          <p><b>{movieTitle}</b></p>
          <img src={url} alt="Imagen del DÃ­a de la Marmota"/>
        </div>
       )
    }
    
    const FecthPosts = () => {
        const [posts, setPosts] = React.useState([]); // Hook para hacer fetch de los posts
        const [loading, setLoading] = React.useState(true); // hook para el cargado de la imagen
        const [error, setError] = React.useState(null); // hook para manejar errores
      
        React.useEffect(() => {
          const getPosts = async () => {
            try {
              const response = await fetch('https://api.tiburoncin.lat/22398/posts');
              const jsonPosts = await response.json();
              await new Promise(resolve => setTimeout(resolve, 1000))
              setPosts(jsonPosts);

              if (!response.ok) {
                throw new Error('Failed to fetch data');
              }
              } catch (error) {
              setError(error);
              } finally {
              setLoading(false);
      }
          };
      
          getPosts();
        }, []); 
      
         if (error) {
          return <div className="centerPage">
            Error comunicando con la API: {error.message}
          </div>;
        }

        return (
          <div className="centerPage">
            {loading ? (
              <Loading />
            ) :
              posts.map((item, index) => (
              <div key={index} className="post">
                
                <div className="postContent">
                  <ImageRender url={item.imgSrc} movieTitle={item.pelicula}/>
                  <div className="postText">
                    <b>{item.title}</b><br/>
                    {item.content}<br/><br/><br/>
                    Fecha de creacion: {item.created_at}
                  </div>
                </div>
              </div>
            ))}
          </div>
        );
      };

      const App = () => {
        
        return (
          <div>
            <React.Suspense fallback={<Loading />}>
              <FecthPosts />
            </React.Suspense>
          </div>
        );
      };

      const root = ReactDOM.createRoot(document.getElementById('root'))
    root.render(<App />)
    </script>
</body>
</html>