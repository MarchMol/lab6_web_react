<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Blog Marchena</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel"> 
      document.body.style.backgroundImage = "url('https://wallpaperaccess.com/full/5457303.png')";
      document.body.style.display = "flex";
      document.body.style.flexDirection = "column";
      document.body.style.alignItems = "center";
      document.body.style.height = "100vh";
      document.body.style.margin = "0";
      document.body.style.fontFamily = "sans-serif";


      const rootElement = document.getElementById('root');
      if (rootElement) {
        rootElement.style.display = 'flex';
        rootElement.style.justifyContent = 'center';
      }

      const Header = () => {
        const styles = {
          header: {
            backgroundColor: '#9DD1E5',
            padding: '3vh',
            fontSize: '3.5vh',
            width: '49.2vw',
            display: 'flex',
            alignItems: 'center',
            justifyContent: 'center',
          }
        };
        return <header style={styles.header}>Mi blog de peliculas</header>
      }

      const Loading = () => {
        const [rotation, setRotation] = React.useState(0);
      
        React.useEffect(() => {
          const intervalId = setInterval(() => {
            setRotation(rotation => rotation + 2);
          }, 10);
      
          return () => clearInterval(intervalId);
        }, []); 

        const style = {
          loading: {
            width: '10vh', /* Adjust width as needed */
            height: 'auto', /* Maintain aspect ratio */
            transform: `rotate(${rotation}deg)`
        }
        };
      
        return (
          <center>
            <img src="https://cdn-icons-png.flaticon.com/512/189/189792.png" alt="Cargando Contenido" style={style.loading}/>
          </center>
            
        );
      };


    const ImageRender = ({url, movieTitle}) => {
      const style ={
          imgHolder: {
            display: 'flex',
            flexDirection: 'column',
            alignItems: 'center',
            padding: '2vh',
            backgroundColor: '#EFEF90',
            width: 'fit-content',
            borderRadius: '2vh',
            borderBottom: 'solid 0.5vh #d6b77d',
            borderLeft: 'solid 0.5vh #d6b77d'
          },
          img: {
            maxHeight: '40vh',
            maxWidth: '13vw',
          }
      };

       return(
        <div style={style.imgHolder}>
          <p><b>{movieTitle}</b></p>
          <img src={url} alt={movieTitle} style={style.img}/>
        </div>
       )
    }
    
    const FecthPosts = () => {
        const [posts, setPosts] = React.useState([]); // Hook para hacer fetch de los posts
        const [loading, setLoading] = React.useState(true); // hook para el cargado de la imagen
        const [error, setError] = React.useState(null); // hook para manejar errores
      
        React.useEffect(() => {
          const getPosts = async () => {
            try {
              const response = await fetch('https://api.tiburoncin.lat/22398/posts');
              const jsonPosts = await response.json();
              await new Promise(resolve => setTimeout(resolve, 1000))
              setPosts(jsonPosts);

              if (!response.ok) {
                throw new Error('Failed to fetch data');
              }
              } catch (error) {
              setError(error);
              } finally {
              setLoading(false);
      }
          };
      
          getPosts();
        }, []); 

        const styles = {
          postContent: {
            display: 'flex',
            alignItems: 'center',
            gap: '2vh'
          },
          postText: {
            display: 'flex',
            flexDirection: 'column',
            gap: '3vh'
          },
          centerPage: {
            backgroundColor: '#ACA6E5',
            height: 'fit-content',
            width: '50vw',
            padding: '2vh',
            display: 'flex',
            flexDirection: 'column',
            gap: '4vh'
          },
          post: {
            backgroundColor: '#E5BAD1',
            borderRadius: '2vh',
            width: '46vw',
            height: 'fit-content',
            padding: '2vh',
            borderBottom: 'solid 0.5vh #c9a1a1',
            borderLeft: 'solid 0.5vh #c9a1a1'
          }
        };

        
         if (error) {
          return <div style={styles.centerPage}>
            Error comunicando con la API: {error.message}
          </div>;
        }

        return (
          <div style={styles.centerPage}>
            {loading ? 
              <Loading />
              : 
              posts.map((item, index) => (
                <div key={index} style={styles.post}>
                  
                  <div style={styles.postContent}>
                    <ImageRender url={item.imgSrc} movieTitle={item.pelicula}/>
                    <div style={styles.postText}>
                      <b>{item.title}</b><br/>
                      {item.content}<br/><br/><br/>
                      Fecha de creacion: {item.created_at}
                    </div>
                  </div>
                </div>
              ))}
          </div>
        );
      };

      const App = () => {
        
        return (
          <div>
            <Header />
            <React.Suspense fallback={<Loading />}>
              <FecthPosts />
            </React.Suspense>
          </div>
        );
      };

      const root = ReactDOM.createRoot(document.getElementById('root'))
    root.render(<App />)
    </script>
</body>
</html>